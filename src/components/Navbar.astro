---
const SUPABASE_URL = import.meta.env.PUBLIC_SUPABASE_URL;
const SUPABASE_KEY = import.meta.env.PUBLIC_SUPABASE_ANON_KEY;
---

<header class="fixed top-0 z-50 w-full bg-white border-b border-neutral-200">
  <div class="mx-auto max-w-6xl px-6 h-16 flex items-center justify-between">
    <a href="/" class="text-sm uppercase tracking-widest text-neutral-900">
      Umi No Nami 海のナミ
    </a>

    <!-- NAV -->
    <nav
  id="nav"
  class="flex items-center gap-6 text-sm text-neutral-700"
  hidden
>
  <!-- default (logged out) -->
  <a href="/">Home</a>
  <a href="/about">About</a>
  <a href="/login">Login</a>
  <a href="/signup">Sign up</a>
</nav>

  </div>
</header>

<script
  type="module"
  define:vars={{ SUPABASE_URL, SUPABASE_KEY }}
>
  import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

  const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

  const nav = document.getElementById("nav");
  if (!nav) {
    console.warn("Navbar not found");
  } else {
    function render(session) {
  nav.hidden = false;

  nav.innerHTML = session
    ? `
      <a href="/">Home</a>
      <a href="/writings">Writings</a>
      <a href="/posts/new">Write</a>
      <a href="/account">Account</a>
      <button id="logout" type="button">Log out</button>

    `
    : `
      <a href="/">Home</a>
      <a href="/about">About</a>
      <a href="/login">Login</a>
      <a href="/signup">Sign up</a>
    `;
}



    // Initial state
    supabase.auth.getSession().then(({ data }) => {
      render(data.session);
    });

    // React to login/logout
    supabase.auth.onAuthStateChange((_event, session) => {
      render(session);
    });
    document.addEventListener("click", async (e) => {
  if (e.target?.id === "logout") {
    await supabase.auth.signOut();
    render(null);
    window.location.href = "/";
  }
});

  }
</script>
